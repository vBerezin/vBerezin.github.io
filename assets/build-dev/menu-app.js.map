{"version":3,"sources":["webpack://[name]/./common/classes/class-menu-app.js"],"names":["MenuApp","data","options","Error","title","dropdownBtn","closeBtn","backBtn","onOpen","onClose","active","current","menu","createMenu","overlay","makeOverlay","item","index","delay","dataAttr","activeClass","dropdownClass","toggle","link","children","url","urls","window","location","href","pathname","search","forEach","root","items","map","makeItem","join","path","target","newTarget","btnBack","length","callback","classList","add","style","display","document","body","overflow","remove","actions","dropdown","dataset","push","getItem","innerHTML","render","makeList","back","pop","close","addEventListener","event","action","preventDefault","parentNode","createElement","className","onclick","bindEvents"],"mappings":"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","file":"menu-app.js","sourcesContent":["/**\n * @description мобильное меню\n * @param {object} data - { title, url, active, children:{dataN}},{...},{N}\n * @public {open} открыть меню\n * @public {close} закрыть меню\n * */\nclass MenuApp {\n  constructor(data, options) {\n    if (!data || typeof data !== 'object') {\n      return new Error('data must be JSON');\n    }\n    this.options = Object.assign({\n      title: 'Меню',\n      dropdownBtn: '<svg class=\"c-icon c-icon-svg c-icon-svg-right\">'\n        + '<use xlink:href=\"/assets/images/icons.svg#right\"></use></svg>',\n      closeBtn: '<svg class=\"c-icon c-icon-svg c-icon-svg-close\">'\n        + '<use xlink:href=\"/assets/images/icons.svg#close\"></use></svg>',\n      backBtn: '<svg class=\"c-icon c-icon-svg c-icon-svg-left\">'\n        + '<use xlink:href=\"/assets/images/icons.svg#left\"></use></svg>',\n      onOpen: () => false,\n      onClose: () => false,\n    }, options);\n    this.data = data;\n    this.active = false;\n    this.current = [];\n    this.menu = this.createMenu();\n    this.overlay = this.makeOverlay();\n  }\n\n  makeItem(item, index) {\n    const delay = `${index * 50}ms`;\n    const dataAttr = `data-action=\"dropdown\" data-index=\"${index}\"`;\n    let activeClass = item.active ? 'is-active' : '';\n    let dropdownClass = '';\n    let toggle = '';\n    let link = `<span class=\"c-menu-app__item-link\">${item.title}</span>`;\n    if (item.children) {\n      dropdownClass = 'has-dropdown';\n      toggle = `<button ${dataAttr} class=\"c-menu-app__toggle\">${this.options.dropdownBtn}</button>`;\n      link = `<span ${dataAttr} class=\"c-menu-app__item-link\">${item.title}</span>`;\n    }\n    if (!item.active && item.url) {\n      const urls = [\n        window.location.href,\n        window.location.pathname + window.location.search,\n        window.location.pathname,\n      ];\n      urls.forEach((url) => {\n        if (url === item.url) {\n          activeClass = 'is-active';\n          return activeClass;\n        }\n        return url;\n      });\n    }\n    if (item.url) {\n      link = `<a class=\"c-menu-app__item-link\" href=\"${item.url}\">${item.title}</a>`;\n    }\n    return `<div class=\"c-menu-app__item ${activeClass} ${dropdownClass}\" \n            style=\"animation-delay:${delay}\">${link}${toggle}</div>`;\n  }\n\n  makeList(root) {\n    const items = root.map((item, index) => `<li>${this.makeItem(item, index)}</li>`);\n    return `<ul>${items.join('')}</ul>`;\n  }\n\n  getItem(path) {\n    let target = this.data;\n    path.forEach((index) => {\n      let newTarget = target[index];\n      if (target.children && target.children[index] && target.children[index].children) {\n        newTarget = target.children[index];\n      }\n      if (newTarget) target = newTarget;\n    });\n    return target;\n  }\n\n  render(title, menu) {\n    let btnBack = `<button class=\"c-menu-app__back\" \n                    data-action=\"back\">${this.options.backBtn}</button>`;\n    if (!this.current.length) btnBack = '';\n    return `<div class=\"c-menu-app__head\">${btnBack}\n            <button class=\"c-menu-app__close\"\n                data-action=\"close\">${this.options.closeBtn}</button>\n            <div class=\"c-menu-app__title\" \n                data-action=\"back\">${title || this.options.title}</div>\n            </div>\n            <div class=\"c-menu-app__body\"><div class=\"c-menu-app__nav\">${menu}</div></div>`;\n  }\n\n  open(callback) {\n    if (!this.menu) return false;\n    this.menu.classList.add('is-active');\n    this.active = true;\n    this.menu.style.display = 'block';\n    this.overlay.style.display = 'block';\n    document.body.style.overflow = 'hidden';\n    if (callback && typeof callback === 'function') callback(this.menu);\n    if (typeof this.options.onOpen === 'function') this.options.onOpen(this.menu);\n    return this.menu;\n  }\n\n  close(callback) {\n    if (!this.menu) return false;\n    this.menu.classList.remove('is-active');\n    this.active = false;\n    this.menu.style.display = 'none';\n    this.overlay.style.display = 'none';\n    document.body.style.overflow = '';\n    if (callback && typeof callback === 'function') callback(this.menu);\n    if (typeof this.options.onClose === 'function') this.options.onClose(this.menu);\n    return this.menu;\n  }\n\n  bindEvents(menu) {\n    const actions = {\n      dropdown: (target) => {\n        const { index } = target.dataset;\n        this.current.push(index);\n        const item = this.getItem(this.current);\n        this.menu.innerHTML = this.render(item.title, this.makeList(item.children));\n        return this.menu;\n      },\n      back: () => {\n        if (!this.current.length) return false;\n        this.current.pop();\n        const item = this.getItem(this.current);\n        const dropdown = item.children || item;\n        const title = item.title || this.options.title;\n        this.menu.innerHTML = this.render(title, this.makeList(dropdown));\n        return this.menu;\n      },\n      close: () => this.close(),\n    };\n    menu.addEventListener('click', (event) => {\n      let { target } = event;\n      while (target !== menu) {\n        if (target.dataset && target.dataset.action) {\n          const { action } = target.dataset;\n          if (actions[action]) actions[action](target);\n          event.preventDefault();\n          break;\n        }\n        target = target.parentNode;\n      }\n    });\n  }\n\n  makeOverlay() {\n    const overlay = document.createElement('div');\n    overlay.className = 'c-menu-app-overlay';\n    overlay.style.display = 'none';\n    this.overlay = overlay;\n    this.overlay.onclick = () => {\n      this.close();\n    };\n    return overlay;\n  }\n\n  createMenu() {\n    this.menu = document.createElement('nav');\n    this.menu.className = 'c-menu-app';\n    this.menu.style.display = 'none';\n    this.menu.innerHTML = this.render(this.options.title, this.makeList(this.data));\n    this.bindEvents(this.menu);\n    return this.menu;\n  }\n}\n\nexport default MenuApp;\n"],"sourceRoot":""}